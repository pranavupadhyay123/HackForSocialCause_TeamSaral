<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SARAL (Smart Alert & Resilient Aid Layer) - Central Command</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        .animate-fade-in {
            animation: fadeIn 0.5s ease-in;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        #admin-map {
            height: 100%;
            width: 100%;
            z-index: 1;
            min-height: 350px;
        }

        /* Custom scrollbar for logs */
        .custom-scroll::-webkit-scrollbar {
            width: 6px;
        }

        .custom-scroll::-webkit-scrollbar-thumb {
            background: #4b5563;
            border-radius: 4px;
        }

        .custom-scroll::-webkit-scrollbar-track {
            background: #1f2937;
        }
    </style>
</head>

<body class="bg-gray-900 text-white font-sans min-h-screen lg:h-screen lg:overflow-hidden flex flex-col">

    <!-- NAVBAR -->
    <nav class="bg-gray-900 text-white p-3 shadow-lg border-b border-gray-700 flex-shrink-0 relative z-20">
        <div class="flex flex-col md:flex-row md:items-center justify-between gap-4">
            <!-- BRAND -->
            <div class="flex items-center gap-3">
                <div class="bg-blue-600/20 p-2 rounded-lg border border-blue-500/50">
                    <i class="fas fa-shield-virus text-2xl text-blue-400"></i>
                </div>
                <div>
                    <!-- Mobile Title -->
                    <h1
                        class="text-xl font-black tracking-wider bg-gradient-to-r from-blue-400 to-purple-500 bg-clip-text text-transparent md:hidden">
                        SARAL COMMAND
                    </h1>
                    <!-- Desktop Title -->
                    <h1 class="hidden md:block text-2xl font-black tracking-wider bg-gradient-to-r from-blue-400 to-purple-500 bg-clip-text text-transparent"
                        data-i18n="admin_title">
                        SARAL (System for Advanced Resilient Aid Layer) COMMAND CENTER
                    </h1>
                    <p class="hidden md:block text-[10px] text-gray-400 uppercase tracking-[0.2em]"
                        data-i18n="admin_subtitle">Disaster
                        Management System</p>
                </div>
            </div>

            <!-- CONTROLS -->
            <div class="flex items-center justify-between md:justify-end gap-4 w-full md:w-auto">
                <select onchange="changeLanguage(this.value)"
                    class="bg-gray-800 text-white text-xs p-2 rounded border border-gray-600 focus:outline-none">
                    <option value="en">üá¨üáß EN</option>
                    <option value="hi">üáÆüá≥ HI</option>
                    <option value="mr">üáÆüá≥ MR</option>
                    <option value="bn">üáÆüá≥ BN</option>
                </select>

                <div class="flex items-center gap-4">
                    <div class="text-right bg-gray-800/50 px-2 py-1 rounded border border-gray-700">
                        <div class="text-[10px] text-gray-400 font-bold uppercase" data-i18n="active_units">Users</div>
                        <div class="text-xl font-mono font-bold text-green-400 leading-none" id="active-count">0</div>
                    </div>
                    <span id="clock" class="hidden sm:block text-gray-400 font-mono text-lg">00:00:00</span>
                </div>
            </div>
        </div>
    </nav>

    <div
        class="flex-grow p-4 grid grid-cols-1 lg:grid-cols-4 gap-4 overflow-y-auto lg:overflow-hidden relative z-10 w-full max-w-[1920px] mx-auto">

        <!-- LEFT PANEL: ALERTS & CONTROLS -->
        <div
            class="bg-gray-800 p-4 rounded-xl shadow-lg lg:col-span-1 flex flex-col gap-4 h-full overflow-hidden custom-scroll overflow-y-auto">

            <!-- LIVE SITUATION FEED -->
            <div class="bg-blue-900/20 border border-blue-700 p-3 rounded-lg">
                <h3 class="text-xs font-bold text-blue-400 uppercase mb-2"><i class="fas fa-rss"></i> <span
                        data-i18n="live_feed_title">Live Situation Feed</span></h3>
                <div class="space-y-2 text-xs" id="live-feed-container">
                    <div class="flex justify-between items-center bg-gray-900/50 p-2 rounded">
                        <span class="text-yellow-400"><i class="fas fa-wind"></i> Cyclone Alert</span>
                        <span class="font-mono text-gray-300" id="feed-cyclone">Lvl 3 (Exp. 4h)</span>
                    </div>
                    <div class="flex justify-between items-center bg-gray-900/50 p-2 rounded">
                        <span class="text-orange-400"><i class="fas fa-fire"></i> Forest Fire Risk</span>
                        <span class="font-mono text-gray-300" id="feed-fire">High (18km/h Wind)</span>
                    </div>
                    <div class="flex justify-between items-center bg-gray-900/50 p-2 rounded">
                        <span class="text-blue-400"><i class="fas fa-water"></i> River Level</span>
                        <span class="font-mono text-red-400 animate-pulse" id="feed-river">Rising (+12cm)</span>
                    </div>
                </div>
            </div>

            <!-- DISASTER CONTROL -->
            <div class="bg-red-900/20 border border-red-700 p-4 rounded-xl shadow-lg relative shrink-0">
                <h2 class="text-lg font-bold text-red-400 mb-3"><i class="fas fa-bullhorn"></i> <span
                        data-i18n="broadcast_alert_title">Broadcast Alert</span></h2>
                <div class="space-y-3">
                    <div>
                        <label class="text-[10px] text-red-300 uppercase font-bold"
                            data-i18n="lbl_disaster_type">Disaster Type</label>
                        <select id="disaster-type"
                            class="w-full bg-gray-900 border border-red-500 rounded p-2 text-sm text-white">
                            <option value="FLOOD">üåä Flood / Tsunami</option>
                            <option value="EARTHQUAKE">üìâ Earthquake</option>
                            <option value="FIRE">üî• Urban Fire</option>
                            <option value="BIOHAZARD">‚ò£ Bio-Hazard / Gas Leak</option>
                        </select>
                    </div>
                    <div>
                        <label class="text-[10px] text-red-300 uppercase font-bold" data-i18n="lbl_impact_zone">Impact
                            Zone</label>
                        <select id="disaster-zone"
                            class="w-full bg-gray-900 border border-red-500 rounded p-2 text-sm text-white">
                            <option value="ZONE-A">Zone A (Urban Center)</option>
                            <option value="ZONE-B">Zone B (Coastal/River)</option>
                            <option value="ZONE-C">Zone C (Industrial)</option>
                            <option value="ALL">‚ö† ALL ZONES (General Evac)</option>
                        </select>
                    </div>
                    <button onclick="declareDisaster()"
                        class="w-full bg-red-600 hover:bg-red-700 text-white font-bold py-2 rounded shadow-lg border border-red-400 active:scale-95 transition flex items-center justify-center gap-2 text-sm"
                        data-i18n="btn_declare_emergency">
                        <i class="fas fa-tower-broadcast"></i> SEND ALERT
                    </button>
                    <button onclick="clearDisaster()" id="clear-btn"
                        class="hidden w-full bg-green-600 hover:bg-green-700 text-white font-bold py-2 rounded shadow border border-green-400 text-sm"
                        data-i18n="btn_clear_all">
                        ‚úÖ ALL CLEAR
                    </button>
                </div>
            </div>

            <!-- INFRASTRUCTURE LAYERS -->


        </div>

        <!-- CENTER PANEL: MAP & INCIDENTS -->
        <div class="lg:col-span-2 flex flex-col gap-4 h-full overflow-hidden">

            <!-- MAP -->
            <div
                class="bg-gray-800 p-2 rounded-xl shadow-lg border border-gray-700 relative flex-shrink-0 h-[400px] lg:h-[50%]">
                <div
                    class="absolute top-4 right-4 z-[500] bg-black/80 px-3 py-1 rounded text-xs font-mono border border-gray-500 shadow-lg">
                    <span data-i18n="active_units"></span>Active Signals</span>: <span id="active-count"
                        class="text-green-400 font-bold text-lg">0</span>
                </div>
                <div id="admin-map" class="rounded border border-gray-600"></div>
            </div>

            <!-- INCIDENT TABLE -->
            <div class="bg-white text-gray-800 rounded-xl shadow-lg flex-1 overflow-hidden flex flex-col">
                <div class="flex justify-between items-center p-3 border-b bg-gray-50">
                    <h2 class="text-lg font-bold text-gray-800 border-l-4 border-blue-600 pl-3">Live Incident Feed</h2>
                    <button onclick="document.getElementById('incident-table').innerHTML = ''"
                        class="text-xs bg-gray-200 text-gray-700 px-3 py-1 rounded hover:bg-gray-300 font-bold">Clear</button>
                </div>
                <div class="overflow-auto flex-1 custom-scroll">
                    <table class="min-w-full text-sm text-left">
                        <thead class="bg-gray-100 text-gray-600 uppercase text-xs sticky top-0 z-10 shadow-sm">
                            <tr>
                                <th class="px-4 py-2">Time</th>
                                <th class="px-4 py-2">Type</th>
                                <th class="px-4 py-2">Details</th>
                                <th class="px-4 py-2">Location</th>
                                <th class="px-4 py-2">Action</th>
                            </tr>
                        </thead>
                        <tbody id="incident-table">
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- RIGHT PANEL: RESOURCES & TRIAGE -->
        <div
            class="bg-gray-800 p-4 rounded-xl shadow-lg lg:col-span-1 flex flex-col gap-4 h-full overflow-hidden custom-scroll overflow-y-auto">

            <!-- RESOURCE LOGISTICS -->
            <div class="bg-gray-900 p-3 rounded-lg border border-gray-700 shrink-0">
                <h3 class="text-xs font-bold text-purple-400 uppercase mb-2"><i class="fas fa-boxes"></i> <span
                        data-i18n="resource_logistics_title">Resource Logistics</span></h3>
                <div class="space-y-2 text-xs">
                    <div class="flex justify-between items-center border-b border-gray-800 pb-1">
                        <span class="text-blue-300">üíß Water Packs</span>
                        <div class="text-right">
                            <span class="text-green-400 font-mono" id="res-water-avail">1000</span>
                            <span class="text-gray-500">/</span>
                            <span class="text-red-400 font-mono" id="res-water-req">0</span>
                        </div>
                    </div>
                    <div class="flex justify-between items-center border-b border-gray-800 pb-1">
                        <span class="text-orange-300">üß£ Blankets</span>
                        <div class="text-right">
                            <span class="text-green-400 font-mono" id="res-blankets-avail">1000</span>
                            <span class="text-gray-500">/</span>
                            <span class="text-red-400 font-mono" id="res-blankets-req">0</span>
                        </div>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-red-300">üöë Ambulances</span>
                        <div class="text-right">
                            <span class="text-green-400 font-mono" id="res-amb-avail">1000</span>
                            <span class="text-gray-500">/</span>
                            <span class="text-red-400 font-mono" id="res-amb-req">0</span>
                        </div>
                    </div>
                </div>
                <div class="flex gap-2 mt-3">
                    <button onclick="dispatchResource()"
                        class="flex-1 bg-purple-600 hover:bg-purple-500 text-white py-1 rounded text-[10px] font-bold"
                        data-i18n="btn_dispatch">DISPATCH</button>
                    <button onclick="markDelivered()"
                        class="flex-1 bg-gray-700 hover:bg-gray-600 text-gray-300 py-1 rounded text-[10px] font-bold"
                        data-i18n="btn_restock">RESTOCK</button>
                </div>
            </div>

            <!-- REGISTERED VOLUNTEERS (New Panel) -->
            <div class="bg-gray-900 p-3 rounded-lg border border-gray-700 shrink-0 flex flex-col gap-2 min-h-[150px]">
                <h3 class="text-xs font-bold text-blue-400 uppercase"><i class="fas fa-users"></i> Registered Volunteers
                </h3>
                <div id="volunteer-list" class="space-y-2 overflow-y-auto custom-scroll flex-grow pr-1">
                    <!-- Dynamic Volunteer Cards -->
                </div>
            </div>
            <!-- INCIDENT LOG (History) -->
            <div class="flex-grow flex flex-col min-h-0 bg-gray-900 rounded border border-gray-700">
                <h3 class="text-xs font-bold text-gray-400 uppercase p-2 shrink-0 border-b border-gray-800"><i
                        class="fas fa-history"></i> <span data-i18n="incident_log_title">Incident Log</span></h3>
                <div class="overflow-y-auto custom-scroll flex-grow">
                    <table class="w-full text-left border-collapse">
                        <thead class="bg-gray-800 text-gray-400 text-[10px] sticky top-0">
                            <tr>
                                <th class="p-2" data-i18n="th_time">Time</th>
                                <th class="p-2" data-i18n="th_type">Type</th>
                                <th class="p-2" data-i18n="th_details">Details</th>
                                <th class="p-2" data-i18n="th_location">Location</th>
                                <th class="p-2" data-i18n="th_status">Status</th>
                            </tr>
                        </thead>
                        <tbody id="history-table" class="text-[10px] text-gray-300 divide-y divide-gray-800">
                            <!-- Rows added dynamically -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

    </div>

    </div>

    <script>
        const translations = {
            en: {
                admin_title: "SARAL (Smart Alert & Resilient Aid Layer) COMMAND CENTER",
                admin_subtitle: "Disaster Management System",
                active_units: "Active Units",
                live_feed_title: "Live Situation Feed",
                broadcast_alert_title: "Broadcast Alert",
                lbl_disaster_type: "Disaster Type",
                lbl_impact_zone: "Impact Zone",
                btn_declare_emergency: "DECLARE EMERGENCY",
                btn_clear_all: "CLEAR ALL",
                infra_status_title: "Infrastructure Status",
                triage_board_title: "Triage Board",
                lbl_critical: "Critical",
                lbl_moderate: "Moderate",
                lbl_minor: "Minor",
                resource_logistics_title: "Resource Logistics",
                btn_dispatch: "Dispatch",
                btn_restock: "Restock",
                incident_log_title: "Incident Log",
                th_time: "Time",
                th_type: "Type",
                th_location: "Location",
                th_details: "Details",
                th_status: "Status"
            },
            hi: {
                admin_title: "‡§∏‡§∞‡§≤ ‡§ï‡§Æ‡§æ‡§Ç‡§° ‡§∏‡•á‡§Ç‡§ü‡§∞",
                admin_subtitle: "‡§Ü‡§™‡§¶‡§æ ‡§™‡•ç‡§∞‡§¨‡§Ç‡§ß‡§® ‡§™‡•ç‡§∞‡§£‡§æ‡§≤‡•Ä",
                active_units: "‡§∏‡§ï‡•ç‡§∞‡§ø‡§Ø ‡§á‡§ï‡§æ‡§á‡§Ø‡§æ‡§Å",
                live_feed_title: "‡§≤‡§æ‡§á‡§µ ‡§∏‡•ç‡§•‡§ø‡§§‡§ø ‡§´‡•Ä‡§°",
                broadcast_alert_title: "‡§ö‡•á‡§§‡§æ‡§µ‡§®‡•Ä ‡§™‡•ç‡§∞‡§∏‡§æ‡§∞‡§ø‡§§ ‡§ï‡§∞‡•á‡§Ç",
                lbl_disaster_type: "‡§Ü‡§™‡§¶‡§æ ‡§ï‡§æ ‡§™‡•ç‡§∞‡§ï‡§æ‡§∞",
                lbl_impact_zone: "‡§™‡•ç‡§∞‡§≠‡§æ‡§µ ‡§ï‡•ç‡§∑‡•á‡§§‡•ç‡§∞",
                btn_declare_emergency: "‡§Ü‡§™‡§æ‡§§‡§ï‡§æ‡§≤ ‡§ò‡•ã‡§∑‡§ø‡§§ ‡§ï‡§∞‡•á‡§Ç",
                btn_clear_all: "‡§∏‡§≠‡•Ä ‡§∏‡§æ‡§´‡§º ‡§ï‡§∞‡•á‡§Ç",
                infra_status_title: "‡§¨‡•Å‡§®‡§ø‡§Ø‡§æ‡§¶‡•Ä ‡§¢‡§æ‡§Ç‡§ö‡§æ ‡§∏‡•ç‡§•‡§ø‡§§‡§ø",
                triage_board_title: "‡§ü‡•ç‡§∞‡§æ‡§á‡§è‡§ú ‡§¨‡•ã‡§∞‡•ç‡§°",
                lbl_critical: "‡§ó‡§Ç‡§≠‡•Ä‡§∞",
                lbl_moderate: "‡§Æ‡§ß‡•ç‡§Ø‡§Æ",
                lbl_minor: "‡§Æ‡§æ‡§Æ‡•Ç‡§≤‡•Ä",
                resource_logistics_title: "‡§∏‡§Ç‡§∏‡§æ‡§ß‡§® ‡§∞‡§∏‡§¶",
                btn_dispatch: "‡§≠‡•á‡§ú‡•á‡§Ç (Dispatch)",
                btn_restock: "‡§™‡•Å‡§®‡§É ‡§∏‡•ç‡§ü‡•â‡§ï ‡§ï‡§∞‡•á‡§Ç",
                incident_log_title: "‡§ò‡§ü‡§®‡§æ ‡§≤‡•â‡§ó",
                th_time: "‡§∏‡§Æ‡§Ø",
                th_type: "‡§™‡•ç‡§∞‡§ï‡§æ‡§∞",
                th_location: "‡§∏‡•ç‡§•‡§æ‡§®",
                th_details: "‡§µ‡§ø‡§µ‡§∞‡§£",
                th_status: "‡§∏‡•ç‡§•‡§ø‡§§‡§ø"
            },
            mr: {
                admin_title: "‡§∏‡§∞‡§≤ ‡§ï‡§Æ‡§æ‡§Ç‡§° ‡§∏‡•á‡§Ç‡§ü‡§∞",
                admin_subtitle: "‡§Ü‡§™‡§§‡•ç‡§§‡•Ä ‡§µ‡•ç‡§Ø‡§µ‡§∏‡•ç‡§•‡§æ‡§™‡§® ‡§™‡•ç‡§∞‡§£‡§æ‡§≤‡•Ä",
                active_units: "‡§∏‡§ï‡•ç‡§∞‡§ø‡§Ø ‡§Ø‡•Å‡§®‡§ø‡§ü‡•ç‡§∏",
                live_feed_title: "‡§•‡•á‡§ü ‡§™‡§∞‡§ø‡§∏‡•ç‡§•‡§ø‡§§‡•Ä ‡§´‡•Ä‡§°",
                broadcast_alert_title: "‡§∏‡§§‡§∞‡•ç‡§ï‡§§‡§æ ‡§™‡•ç‡§∞‡§∏‡§æ‡§∞‡§ø‡§§ ‡§ï‡§∞‡§æ",
                lbl_disaster_type: "‡§Ü‡§™‡§§‡•ç‡§§‡•Ä‡§ö‡§æ ‡§™‡•ç‡§∞‡§ï‡§æ‡§∞",
                lbl_impact_zone: "‡§™‡•ç‡§∞‡§≠‡§æ‡§µ ‡§ï‡•ç‡§∑‡•á‡§§‡•ç‡§∞",
                btn_declare_emergency: "‡§Ü‡§£‡•Ä‡§¨‡§æ‡§£‡•Ä ‡§ò‡•ã‡§∑‡§ø‡§§ ‡§ï‡§∞‡§æ",
                btn_clear_all: "‡§∏‡§∞‡•ç‡§µ ‡§∏‡§æ‡§´ ‡§ï‡§∞‡§æ",
                infra_status_title: "‡§™‡§æ‡§Ø‡§æ‡§≠‡•Ç‡§§ ‡§∏‡•Å‡§µ‡§ø‡§ß‡§æ ‡§∏‡•ç‡§•‡§ø‡§§‡•Ä",
                triage_board_title: "‡§ü‡•ç‡§∞‡§æ‡§á‡§è‡§ú ‡§¨‡•ã‡§∞‡•ç‡§°",
                lbl_critical: "‡§ó‡§Ç‡§≠‡•Ä‡§∞",
                lbl_moderate: "‡§Æ‡§ß‡•ç‡§Ø‡§Æ",
                lbl_minor: "‡§ï‡§ø‡§∞‡§ï‡•ã‡§≥",
                resource_logistics_title: "‡§∏‡§Ç‡§∏‡§æ‡§ß‡§® ‡§≤‡•â‡§ú‡§ø‡§∏‡•ç‡§ü‡§ø‡§ï‡•ç‡§∏",
                btn_dispatch: "‡§™‡§æ‡§†‡§µ‡§æ (Dispatch)",
                btn_restock: "‡§™‡•Å‡§®‡•ç‡§π‡§æ ‡§∏‡•ç‡§ü‡•â‡§ï ‡§ï‡§∞‡§æ",
                incident_log_title: "‡§ò‡§ü‡§®‡§æ ‡§≤‡•â‡§ó",
                th_time: "‡§µ‡•á‡§≥",
                th_type: "‡§™‡•ç‡§∞‡§ï‡§æ‡§∞",
                th_location: "‡§∏‡•ç‡§•‡§æ‡§®",
                th_details: "‡§§‡§™‡§∂‡•Ä‡§≤",
                th_status: "‡§∏‡•ç‡§•‡§ø‡§§‡•Ä"
            },
            bn: {
                admin_title: "‡¶∏‡¶∞‡¶≤ ‡¶ï‡¶Æ‡¶æ‡¶®‡ßç‡¶° ‡¶∏‡ßá‡¶®‡ßç‡¶ü‡¶æ‡¶∞",
                admin_subtitle: "‡¶¶‡ßÅ‡¶∞‡ßç‡¶Ø‡ßã‡¶ó ‡¶¨‡ßç‡¶Ø‡¶¨‡¶∏‡ßç‡¶•‡¶æ‡¶™‡¶®‡¶æ ‡¶∏‡¶ø‡¶∏‡ßç‡¶ü‡ßá‡¶Æ",
                active_units: "‡¶∏‡¶ï‡ßç‡¶∞‡¶ø‡¶Ø‡¶º ‡¶á‡¶â‡¶®‡¶ø‡¶ü",
                live_feed_title: "‡¶≤‡¶æ‡¶á‡¶≠ ‡¶™‡¶∞‡¶ø‡¶∏‡ßç‡¶•‡¶ø‡¶§‡¶ø ‡¶´‡¶ø‡¶°",
                broadcast_alert_title: "‡¶∏‡¶§‡¶∞‡ßç‡¶ï‡¶§‡¶æ ‡¶™‡ßç‡¶∞‡¶ö‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶®",
                lbl_disaster_type: "‡¶¶‡ßÅ‡¶∞‡ßç‡¶Ø‡ßã‡¶ó‡ßá‡¶∞ ‡¶ß‡¶∞‡¶®",
                lbl_impact_zone: "‡¶™‡ßç‡¶∞‡¶≠‡¶æ‡¶¨ ‡¶Ö‡¶û‡ßç‡¶ö‡¶≤",
                btn_declare_emergency: "‡¶ú‡¶∞‡ßÅ‡¶∞‡ßÄ ‡¶Ö‡¶¨‡¶∏‡ßç‡¶•‡¶æ ‡¶ò‡ßã‡¶∑‡¶£‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®",
                btn_clear_all: "‡¶∏‡¶¨ ‡¶™‡¶∞‡¶ø‡¶∑‡ßç‡¶ï‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶®",
                infra_status_title: "‡¶Ö‡¶¨‡¶ï‡¶æ‡¶†‡¶æ‡¶Æ‡ßã ‡¶Ö‡¶¨‡¶∏‡ßç‡¶•‡¶æ",
                triage_board_title: "‡§ü‡•ç‡§∞‡¶æ‡¶Ø‡¶º‡¶æ‡¶ú ‡¶¨‡ßã‡¶∞‡ßç‡¶°",
                lbl_critical: "‡¶ó‡ßÅ‡¶∞‡ßÅ‡¶§‡¶∞",
                lbl_moderate: "‡¶Æ‡¶æ‡¶ù‡¶æ‡¶∞‡¶ø",
                lbl_minor: "‡¶∏‡¶æ‡¶Æ‡¶æ‡¶®‡ßç‡¶Ø",
                resource_logistics_title: "‡¶∏‡¶Æ‡ßç‡¶™‡¶¶ ‡¶≤‡¶ú‡¶ø‡¶∏‡ßç‡¶ü‡¶ø‡¶ï‡¶∏",
                btn_dispatch: "‡§™‡§æ‡§†‡¶æ‡¶® (Dispatch)",
                btn_restock: "‡¶™‡ßÅ‡¶®‡¶∞‡¶æ‡¶Ø‡¶º ‡¶∏‡ßç‡¶ü‡¶ï ‡¶ï‡¶∞‡ßÅ‡¶®",
                incident_log_title: "‡¶ò‡¶ü‡¶®‡¶æ ‡¶≤‡¶ó",
                th_time: "‡¶∏‡¶Æ‡¶Ø‡¶º",
                th_type: "‡¶ß‡¶∞‡¶®",
                th_location: "‡¶Ö‡¶¨‡¶∏‡ßç‡¶•‡¶æ‡¶®",
                th_details: "‡¶¨‡¶ø‡¶¨‡¶∞‡¶£",
                th_status: "‡¶Ö‡¶¨‡¶∏‡ßç‡¶•‡¶æ"
            }
        };

        function changeLanguage(lang) {
            const t = translations[lang];
            if (!t) return;

            document.querySelectorAll('[data-i18n]').forEach(el => {
                const key = el.getAttribute('data-i18n');
                if (t[key]) {
                    if (el.tagName === 'INPUT' && el.type === 'placeholder') {
                        el.placeholder = t[key];
                    } else {
                        el.innerText = t[key];
                    }
                }
            });
        }
    </script>
    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();
        const channel = {
            postMessage: (data) => {
                socket.emit(data.type, data);
            },
            onmessage: null
        };
        const events = ['LOCATION_UPDATE', 'SOS', 'TRIAGE_REPORT', 'RESOURCE_UPDATE', 'DISASTER_ALERT', 'DISASTER_CLEAR', 'MEDICAL_REPORT', 'HELP_REQUEST', 'VOLUNTEER_JOIN', 'FOUND_PERSON', 'MISSING_PERSON', 'DAMAGE_REPORT'];
        events.forEach(event => {
            socket.on(event, (data) => {
                if (channel.onmessage) {
                    channel.onmessage({ data: data });
                }
            });
        });

        // Listen for Active User Count
        socket.on('ACTIVE_USERS_COUNT', (count) => {
            document.getElementById('active-users').innerText = count;
        });

        let map;
        const activeUsers = {};
        let triageCounts = { critical: 0, moderate: 0, minor: 0 };

        // --- 1. INITIALIZE MAP ---
        // --- 1. INITIALIZE MAP ---
        let hasCentered = false;

        window.addEventListener('load', () => {
            // Default view: India Center
            map = L.map('admin-map').setView([20.5937, 78.9629], 5);
            L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
                attribution: '&copy; OpenStreetMap &copy; CARTO'
            }).addTo(map);
        });

        // --- 2. HANDLE INCOMING MESSAGES ---
        channel.onmessage = (event) => {
            const data = event.data;

            // A. ALWAYS Update Map (Passive tracking)
            if (data.type === 'LOCATION_UPDATE' || data.location) {
                updateMapPosition(data);
            }

            // B. IF ALERT: Add to Table (Active Alert)
            if (data.type !== 'LOCATION_UPDATE' && data.type !== 'DISASTER_ALERT' && data.type !== 'DISASTER_CLEAR') {
                addIncidentRow(data);
                playAlertSound();

                // Update Triage if Health Alert
                if (data.type === 'SOS') {
                    updateTriage('critical');
                } else if (data.type === 'MEDICAL_REPORT') {
                    const severity = data.severity ? data.severity.toLowerCase() : 'minor';
                    updateTriage(severity);
                }
                // 3. Handle Resource Requests
                if (data.type === 'HELP_REQUEST') {
                    const quantity = data.quantity || 1;
                    if (data.details.toLowerCase().includes('food') || data.details.toLowerCase().includes('water')) {
                        resources.water.req += quantity;
                    } else if (data.details.toLowerCase().includes('blanket') || data.details.toLowerCase().includes('shelter')) {
                        resources.blankets.req += quantity;
                    } else if (data.details.toLowerCase().includes('medical') || data.details.toLowerCase().includes('doctor')) {
                        resources.amb.req += quantity;
                    }
                    updateResourceUI();
                }

                // 4. Handle Volunteer Join (Sidebar Profile)
                if (data.type === 'VOLUNTEER_JOIN') {
                    const container = document.getElementById('volunteer-list');
                    const profileCard = document.createElement('div');
                    profileCard.className = "bg-gray-800 p-2 rounded border border-gray-600 flex gap-2 items-center animate-fade-in";
                    profileCard.innerHTML = `
                        <div class="w-8 h-8 rounded-full overflow-hidden bg-gray-700 shrink-0 border border-blue-400">
                             ${data.image
                            ? `<img src="${data.image}" class="w-full h-full object-cover">`
                            : `<i class="fas fa-user-shield text-gray-400 text-xs flex justify-center items-center h-full"></i>`
                        }
                        </div>
                        <div class="overflow-hidden">
                            <div class="text-[10px] font-bold text-white truncate">${data.details.split('|')[0].replace('Volunteer: ', '')}</div>
                            <div class="text-[9px] text-gray-400 truncate">${data.details.split('|')[1] || ''}</div>
                        </div>
                    `;
                    container.prepend(profileCard);
                }

                // 4. Handle Missing Person for Live Feed & Persistent Map Marker
                if (data.type === 'MISSING_PERSON') {
                    // Update Live Feed (Existing Logic)
                    if (data.image) {
                        const feedContainer = document.getElementById('live-feed-container');
                        const feedItem = document.createElement('div');
                        feedItem.className = "bg-purple-900/30 border border-purple-600 p-2 rounded flex gap-2 items-start animate-fade-in cursor-pointer hover:bg-purple-900/50 transition";

                        // Store data for modal
                        feedItem.onclick = () => openFeedModal(data);

                        feedItem.innerHTML = `
                            <img src="${data.image}" class="w-12 h-12 rounded object-cover border border-purple-400">
                            <div>
                                <div class="text-purple-300 font-bold text-[10px] uppercase">Missing Person Reported</div>
                                <div class="text-gray-200 text-[10px] line-clamp-2">${data.details}</div>
                                <div class="text-gray-400 text-[9px] mt-1"><i class="fas fa-map-marker-alt"></i> ${data.location}</div>
                            </div>
                        `;

                        if (feedContainer) {
                            feedContainer.prepend(feedItem);
                        }
                    }

                    // ADD PERSISTENT MARKER TO MAP
                    if (data.location && data.location.includes(',')) {
                        const [lat, lng] = data.location.split(',').map(Number);
                        const marker = L.marker([lat, lng], {
                            icon: L.divIcon({
                                className: 'text-2xl',
                                html: '<div class="bg-white rounded-full p-1 border-2 border-purple-600 shadow-lg"><i class="fas fa-user-circle text-purple-600 text-2xl"></i></div>',
                                iconSize: [36, 36],
                                iconAnchor: [18, 18]
                            })
                        }).addTo(map);

                        marker.bindPopup(`
                            <div class="text-gray-800 text-center">
                                <strong class="text-purple-700">MISSING PERSON</strong><br>
                                <div class="text-xs">${data.details}</div>
                                <div class="text-[10px] text-gray-500 mt-1">Reported: ${data.time}</div>
                                ${data.image ? `<img src="${data.image}" class="mt-2 w-full h-24 object-cover rounded">` : ''}
                            </div>
                         `, { maxWidth: 200 });

                        // Optional: Flash the marker initially?
                    }
                }
            }
        };

        function openFeedModal(data) {
            const modal = document.getElementById('feed-modal');
            const content = document.getElementById('feed-modal-content');

            content.innerHTML = `
                <div class="flex flex-col gap-4">
                    <div class="w-full h-64 bg-black rounded-lg overflow-hidden border border-gray-700 flex items-center justify-center">
                        <img src="${data.image}" class="max-w-full max-h-full object-contain">
                    </div>
                    <div>
                        <div class="flex items-center gap-2 mb-2">
                            <span class="px-2 py-1 bg-purple-900 text-purple-200 text-xs font-bold rounded border border-purple-700">MISSING PERSON</span>
                            <span class="text-gray-400 text-xs font-mono">${data.time}</span>
                        </div>
                        <p class="text-lg text-white font-medium leading-relaxed">${data.details}</p>
                        <div class="mt-2 text-sm text-blue-400 font-mono bg-blue-900/10 p-2 rounded border border-blue-900/30 inline-block">
                            <i class="fas fa-map-marker-alt mr-2"></i> ${data.location}
                        </div>
                    </div>
                </div>
            `;

            modal.classList.remove('hidden');
        }

        function updateTriage(level) {
            // Normalize level
            level = level.toLowerCase();

            // Validate level
            if (level !== 'critical' && level !== 'moderate' && level !== 'minor') {
                console.warn('Invalid triage level:', level);
                return;
            }

            // Increment and Update UI
            if (typeof triageCounts[level] === 'number') {
                triageCounts[level]++;
                const el = document.getElementById(`count-${level}`);
                if (el) {
                    el.innerText = triageCounts[level];
                    // Add a temporary animation to show update
                    el.parentElement.classList.add('animate-pulse');
                    setTimeout(() => el.parentElement.classList.remove('animate-pulse'), 500);
                }
            }
        }

        // --- SOS WORKFLOW ---
        function acknowledgeIncident(userId, btnId, rowId) {
            const btn = document.getElementById(btnId);
            if (!btn) return;

            // 1. Emit Event
            channel.postMessage({ type: 'SOS_ACKNOWLEDGE', userId: userId });

            // 2. Update UI (Change to Resolve Button)
            btn.innerHTML = '<i class="fas fa-check"></i> Solved';
            btn.className = "bg-green-600 hover:bg-green-500 text-white px-3 py-1 rounded text-xs shadow transition border border-green-500 font-bold ml-2";
            btn.setAttribute('onclick', `resolveIncident('${userId}', '${rowId}')`);

            // 3. Mark row as Ack
            const row = document.getElementById(rowId);
            if (row) row.classList.add('bg-blue-900/30');
        }

        function resolveIncident(userId, rowId) {
            // 1. Emit Event
            channel.postMessage({ type: 'SOS_RESOLVE', userId: userId });

            // 2. Remove from Active Table
            const row = document.getElementById(rowId);
            if (row) {
                row.classList.add('opacity-0', 'translate-x-full');
                setTimeout(() => row.remove(), 500); // Wait for animation
            }

            // 3. Update Map (Reset marker to green)
            if (activeUsers[userId] && activeUsers[userId].marker) {
                activeUsers[userId].sosActive = false;
                // It will turn green on next location update or we force it now
                activeUsers[userId].marker.setStyle({ color: '#22c55e', fillColor: '#22c55e', radius: 4 });
            }
        }

        // --- 3. JITTER FUNCTION ---
        function getUniqueOffset(str) {
            let hash = 0;
            for (let i = 0; i < str.length; i++) {
                hash = str.charCodeAt(i) + ((hash << 5) - hash);
            }
            // Use a much larger divisor for smaller offset (Minute difference)
            // 400000 -> 1000000 (0.0001 vs 0.00001 degrees)
            return (hash % 100) / 1000000;
        }

        // --- 4. MAP LOGIC ---
        function updateMapPosition(data) {
            if (!data.location || !data.location.includes(',')) return;
            const [rawLat, rawLng] = data.location.split(',').map(Number);

            // Auto-center on first received signal
            if (!hasCentered) {
                map.setView([rawLat, rawLng], 14);
                hasCentered = true;
            }

            const lat = rawLat + getUniqueOffset(data.userId + 'lat');
            const lng = rawLng + getUniqueOffset(data.userId + 'lng');

            let color = '#22c55e'; // Green
            let radius = 4;
            let isStatic = false;

            if (data.type === 'SOS') {
                color = '#ef4444';
                radius = 10;
                // PERSIST SOS STATE
                if (activeUsers[data.userId]) {
                    activeUsers[data.userId].sosActive = true;
                }
            }
            else if (data.type === 'MISSING_PERSON') { color = '#9333ea'; radius = 8; } // Purple
            else if (data.type === 'DAMAGE_REPORT') { color = '#f97316'; radius = 12; isStatic = true; } // Orange
            else if (data.type === 'MEDICAL_REPORT') {
                if (data.severity === 'critical') color = '#dc2626'; // Red
                else if (data.severity === 'moderate') color = '#ca8a04'; // Yellow
                else color = '#16a34a'; // Green
                radius = 8;
            }
            else if (data.type === 'HELP_REQUEST') { color = '#0d9488'; radius = 8; } // Teal
            else if (data.type === 'VOLUNTEER_JOIN') { color = '#2563eb'; radius = 6; } // Blue

            if (activeUsers[data.userId]) {
                const user = activeUsers[data.userId];
                user.marker.setLatLng([lat, lng]);

                // PERSISTENCE CHECK: If user is in SOS mode, keep it RED
                if (user.sosActive) {
                    color = '#ef4444';
                    radius = 10;
                }

                user.marker.setStyle({ color: color, fillColor: color, radius: radius });
                user.lastUpdate = Date.now();
            } else {
                const marker = L.circleMarker([lat, lng], {
                    color: color, fillColor: color, fillOpacity: 0.7, weight: 1, radius: radius
                }).addTo(map);

                let tooltipText = `ID: ${data.userId}`;
                if (data.type === 'DAMAGE_REPORT') tooltipText = `‚ö† DAMAGE: ${data.details}`;
                else if (data.type === 'MEDICAL_REPORT') tooltipText = `üè• MED: ${data.details}`;
                else if (data.type === 'HELP_REQUEST') tooltipText = `üôã HELP: ${data.details}`;
                else if (data.type === 'VOLUNTEER_JOIN') tooltipText = `ü§ù VOL: ${data.details}`;

                if (data.type === 'SOS') marker.bindTooltip(tooltipText, { Permanent: true, direction: 'top', offset: [0, -5], className: 'bg-red-600 text-white font-bold' }).openTooltip();
                else marker.bindTooltip(tooltipText, { direction: 'top', offset: [0, -5] });

                // POPUP with Details Button
                let popupContent = `
                    <div class="text-xs font-mono p-1">
                        <div class="font-bold border-b border-gray-600 pb-1 mb-1 ${data.type === 'SOS' ? 'text-red-400' : 'text-blue-400'}">${data.type.replace('_', ' ')}</div>
                        <div class="text-gray-300 mb-1">${data.details}</div>
                        <div class="text-gray-500 text-[10px]">${data.time}</div>
                        ${(data.type === 'MISSING_PERSON' || data.image) ?
                        `<button onclick="viewImage('${data.image}', '${data.type}', '${data.details}')" class="mt-2 w-full bg-blue-600 hover:bg-blue-500 text-white text-[10px] py-1 rounded font-bold transition shadow-lg shadow-blue-900/50">
                                <i class="fas fa-expand"></i> VIEW PHOTO
                             </button>`
                        : ''}
                    </div>
                `;
                marker.bindPopup(popupContent, { className: 'custom-popup', minWidth: 200 });

                // Click to open popup
                marker.on('click', () => {
                    marker.openPopup();
                });

                // Click to view details/image


                // If it's a damage report, keep it longer or indefinitely (logic here just adds it)
                activeUsers[data.userId] = { marker: marker, lastUpdate: Date.now() };
            }

            document.getElementById('active-count').innerText = Object.keys(activeUsers).length;
        }

        // --- 5. INCIDENT TABLE ---
        function addIncidentRow(data) {
            const table = document.getElementById('incident-table');
            const rowId = 'inc-' + Date.now();

            let badge = 'bg-blue-100 text-blue-800';
            if (data.type === 'SOS') badge = 'bg-red-100 text-red-800 font-bold animate-pulse';
            else if (data.type === 'MISSING_PERSON') badge = 'bg-purple-100 text-purple-800 font-bold';
            else if (data.type === 'LOST_ITEM') badge = 'bg-gray-100 text-gray-800';
            else if (data.type === 'DAMAGE_REPORT') badge = 'bg-orange-100 text-orange-800 font-bold';
            else if (data.type === 'MEDICAL_REPORT') {
                if (data.severity === 'critical') badge = 'bg-red-100 text-red-800 font-bold';
                else if (data.severity === 'moderate') badge = 'bg-yellow-100 text-yellow-800 font-bold';
                else badge = 'bg-green-100 text-green-800 font-bold';
            }
            else if (data.type === 'HELP_REQUEST') badge = 'bg-teal-100 text-teal-800 font-bold';
            else if (data.type === 'VOLUNTEER_JOIN') badge = 'bg-blue-100 text-blue-800 font-bold';

            const row = `
                <tr id="${rowId}" class="border-b border-gray-800 hover:bg-gray-800 animate-fade-in transition-colors">
                    <td class="px-4 py-2 font-mono text-gray-400 whitespace-nowrap text-xs">${data.time}</td>
                    <td class="px-4 py-2 font-bold text-gray-300 text-xs"><span class="${badge} px-2 py-1 rounded shadow-sm">${data.type}</span></td>
                    <td class="px-4 py-2 text-xs text-gray-300">
                        <div class="font-bold text-gray-400">ID: ${data.userId}</div>
                        ${data.image ?
                    `<div class="mt-1 cursor-pointer group" onclick="viewImage('${data.image}', '${data.type}', '${data.details}')">
                                <img src="${data.image}" class="w-12 h-12 object-cover rounded border border-gray-600 group-hover:border-blue-400 transition">
                                <div class="text-[9px] text-blue-400 mt-0.5 group-hover:underline"><i class="fas fa-search"></i> View Image</div>
                             </div>`
                    : ''}
                        ${data.details || ''}
                    </td>
                    <td class="px-4 py-2 text-xs font-mono text-blue-400 cursor-pointer hover:text-blue-300" onclick="map.setView([${data.location}], 18)">
                        <i class="fas fa-map-marker-alt"></i> ${data.location}
                    </td>
                    <td class="px-4 py-2">
                        ${data.type === 'SOS' || data.type === 'MEDICAL_REPORT'
                    ? `<button id="btn-${rowId}" onclick="acknowledgeIncident('${data.userId}', 'btn-${rowId}', '${rowId}')" 
                                class="bg-blue-600 hover:bg-blue-500 text-white px-3 py-1 rounded text-xs shadow transition border border-blue-500">
                                Acknowledge
                               </button>`
                    : '<span class="text-gray-500 text-xs">Logged</span>'
                }
                    </td>
                </tr>
            `;
            table.insertAdjacentHTML('afterbegin', row);

            // Also add to History Log (Right Panel)
            const historyTable = document.getElementById('history-table');
            if (historyTable) {
                const historyRow = `
                    <tr class="border-b border-gray-800 hover:bg-gray-800 text-[9px]">
                        <td class="p-2 font-mono text-gray-500 whitespace-nowrap">${data.time}</td>
                        <td class="p-2 font-bold text-gray-400"><span class="${badge} px-1 rounded">${data.type}</span></td>
                        <td class="p-2 text-gray-400 truncate max-w-[100px]" title="${data.details}">${data.details || '-'}</td>
                        <td class="p-2 font-mono text-blue-500 cursor-pointer" onclick="map.setView([${data.location}], 18)">${data.location}</td>
                        <td class="p-2 text-gray-500">Active</td>
                    </tr>
                `;
                historyTable.insertAdjacentHTML('afterbegin', historyRow);
            }
        }

        // --- DISASTER LOGIC ---
        function declareDisaster() {
            const type = document.getElementById('disaster-type').value;
            const zone = document.getElementById('disaster-zone').value;

            channel.postMessage({
                type: 'DISASTER_ALERT',
                alertType: type,
                zone: zone,
                time: new Date().toLocaleTimeString()
            });

            alert(`üö® ALERT BROADCAST: ${type} in ${zone}`);
            document.getElementById('clear-btn').classList.remove('hidden');
        }

        function clearDisaster() {
            channel.postMessage({ type: 'DISASTER_CLEAR' });
            document.getElementById('clear-btn').classList.add('hidden');
            alert("‚úÖ All Clear Signal Sent.");
        }

        // --- INFRASTRUCTURE LAYERS (MOCK) ---
        let layers = {};
        function toggleLayer(type, show) {
            if (show) {
                // Add mock layers
                if (type === 'power') {
                    layers.power = L.polyline([[25.430, 81.880], [25.440, 81.890]], { color: 'yellow', weight: 5, dashArray: '10,10' }).addTo(map).bindPopup("Power Line Down");
                } else if (type === 'road') {
                    layers.road = L.circle([25.425, 81.870], { color: 'red', radius: 200 }).addTo(map).bindPopup("Road Blocked");
                } else if (type === 'damage') {
                    layers.damage = L.marker([25.432, 81.885]).addTo(map).bindPopup("Building Collapse Reported");
                }
            } else {
                if (layers[type]) {
                    map.removeLayer(layers[type]);
                    delete layers[type];
                }
            }
        }

        setInterval(() => document.getElementById('clock').innerText = new Date().toLocaleTimeString(), 1000);

        function playAlertSound() {
            const ctx = new (window.AudioContext || window.webkitAudioContext)();
            const osc = ctx.createOscillator();
            osc.type = 'square';
            osc.frequency.setValueAtTime(440, ctx.currentTime);
            osc.connect(ctx.destination);
            osc.start();
            osc.stop(ctx.currentTime + 0.2);
        }

        // --- DYNAMIC FEATURES ---

        // 1. Resource Logistics
        // 1. Resource Logistics
        const resources = {
            water: { avail: 1000, req: 0, name: "Water Packs" },
            blankets: { avail: 1000, req: 0, name: "Blankets" },
            amb: { avail: 1000, req: 0, name: "Ambulances" }
        };

        function updateResourceUI() {
            document.getElementById('res-water-avail').innerText = resources.water.avail;
            document.getElementById('res-water-req').innerText = resources.water.req;
            document.getElementById('res-blankets-avail').innerText = resources.blankets.avail;
            document.getElementById('res-blankets-req').innerText = resources.blankets.req;
            document.getElementById('res-amb-avail').innerText = resources.amb.avail;
            document.getElementById('res-amb-req').innerText = resources.amb.req;
        }

        function dispatchResource() {
            // Find a resource that needs dispatch (Req > 0)
            const keys = Object.keys(resources);
            const needed = keys.filter(k => resources[k].req > 0);

            if (needed.length === 0) {
                alert("All requests fulfilled! No dispatch needed.");
                return;
            }

            // Prioritize the first needed item
            const key = needed[0];
            const required = resources[key].req;
            const available = resources[key].avail;

            if (available >= required) {
                resources[key].avail -= required;
                resources[key].req = 0; // Fulfilled all
                updateResourceUI();
                alert(`üöö Dispatched ${required} Units of ${resources[key].name}`);
            } else if (available > 0) {
                // Partial dispatch
                resources[key].avail = 0;
                resources[key].req -= available;
                updateResourceUI();
                alert(`üöö Dispatched partial ${available} Units of ${resources[key].name}. ${resources[key].req} still needed.`);
            } else {
                alert(`‚ùå Cannot dispatch ${resources[key].name}. Out of Stock!`);
            }
        }

        function markDelivered() {
            // Smart Restock: Refill all resources up to 1000 MAX
            let report = [];
            const keys = Object.keys(resources);
            let anyRestocked = false;

            keys.forEach(key => {
                const current = resources[key].avail;
                if (current < 1000) {
                    const diff = 1000 - current;
                    resources[key].avail = 1000;
                    report.push(`+${diff} ${resources[key].name}`);
                    anyRestocked = true;
                }
            });

            if (anyRestocked) {
                updateResourceUI();
                alert(`üì¶ Smart Restock Complete:\n${report.join('\n')}`);
            } else {
                alert("üì¶ Storage Full. No restock needed (All 1000).");
            }
        }

        // 2. REAL-TIME API FEED (Replaces Simulation)
        socket.on('DISASTER_FEED_UPDATE', (data) => {
            // Update Cyclone
            const cycloneEl = document.getElementById('feed-cyclone');
            cycloneEl.innerText = data.cyclone;

            // Update River
            const riverEl = document.getElementById('feed-river');
            riverEl.innerText = data.river;
            if (data.river.includes('DANGER') || data.river.includes('Rising')) {
                riverEl.className = "font-mono text-red-500 font-bold animate-pulse";
            } else {
                riverEl.className = "font-mono text-gray-300";
            }

            // Update Fire
            const fireEl = document.getElementById('feed-fire');
            fireEl.innerText = data.fire;

            // Optional: Update a 'Last Updated' indicator if needed
            // console.log("Feed Updated:", data.timestamp, "Location:", data.location);
        });
    </script>
    <!-- FEED DETAIL MODAL -->
    <div id="feed-modal"
        class="hidden fixed inset-0 z-[2000] bg-black/80 flex items-center justify-center p-4 backdrop-blur-sm">
        <div
            class="bg-gray-900 w-full max-w-lg rounded-xl p-6 shadow-2xl border border-gray-700 animate-fade-in relative">
            <button onclick="document.getElementById('feed-modal').classList.add('hidden')"
                class="absolute top-4 right-4 text-gray-400 hover:text-white">
                <i class="fas fa-times text-xl"></i>
            </button>
            <h2 class="text-xl font-bold text-blue-400 mb-4 uppercase tracking-wider"><i class="fas fa-info-circle"></i>
                Incident Details</h2>

            <div id="feed-modal-content" class="space-y-4">
                <!-- Content injected via JS -->
            </div>

            <div class="mt-6 flex justify-end gap-3">
                <button onclick="document.getElementById('feed-modal').classList.add('hidden')"
                    class="px-4 py-2 bg-gray-700 hover:bg-gray-600 rounded text-sm font-bold transition">Close</button>
                <button
                    class="px-4 py-2 bg-blue-600 hover:bg-blue-500 rounded text-sm font-bold transition shadow-lg shadow-blue-900/20">Acknowledge</button>
            </div>
        </div>
    </div>

    <!-- IMAGE VIEWER MODAL -->
    <div id="image-modal"
        class="hidden fixed inset-0 z-[2100] bg-black/90 flex items-center justify-center p-4 backdrop-blur-md"
        onclick="closeImageModal()">
        <div class="relative max-w-4xl w-full" onclick="event.stopPropagation()">
            <button onclick="closeImageModal()"
                class="absolute -top-12 right-0 text-white hover:text-gray-300 text-2xl">
                <i class="fas fa-times"></i>
            </button>
            <img id="full-image" src=""
                class="w-full h-auto max-h-[80vh] object-contain rounded-lg shadow-2xl border border-gray-700">
            <div class="mt-4 bg-gray-800 p-4 rounded-lg border border-gray-700">
                <h3 class="text-lg font-bold text-white mb-2" id="image-title">Details</h3>
                <p class="text-gray-300 text-sm" id="image-desc">No details provided.</p>
            </div>
        </div>
    </div>

    <script>
        function viewImage(imgUrl, title, desc) {
            document.getElementById('full-image').src = imgUrl;
            document.getElementById('image-title').innerText = title || 'Details';
            document.getElementById('image-desc').innerText = desc || 'No description available.';
            document.getElementById('image-modal').classList.remove('hidden');
        }

        function closeImageModal() {
            document.getElementById('image-modal').classList.add('hidden');
        }
    </script>

</body>

</html>